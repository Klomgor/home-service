include "/etc/bind/rndc.sops.key";
include "/etc/bind/kubernetes-main.sops.key";
include "/etc/bind/kubernetes-storage.sops.key";

acl internal {
    10.0.0.0/8;
    172.16.0.0/12;
    192.168.0.0/16;
};

controls {
    inet * allow { internal; } keys { rndc-key; };
    inet 127.0.0.1 allow { 127.0.0.1; } keys { rndc-key; };
};

options {
    listen-on port 53 { any; };
    directory "/var/cache/bind";
    allow-query { any; };
    allow-recursion { internal; };
    allow-update { none; };
    dnssec-validation no;
    notify yes;
    also-notify { 192.168.1.84 port 5353; };
    allow-transfer { 192.168.1.84; };
};

zone "devbu.io." {
    type primary;
    file "/etc/bind/zones/devbu.io.zone";
    journal "/var/cache/bind/devbu.io.zone.jnl";
    allow-query { any; };
    allow-transfer {
        key "kubernetes-main-key";
        192.168.1.84;
    };
    update-policy { grant kubernetes-main-key zonesub ANY; };
};

zone "turbo.ac." {
    type primary;
    file "/etc/bind/zones/turbo.ac.zone";
    journal "/var/cache/bind/turbo.ac.zone.jnl";
    allow-query { any; };
    allow-transfer {
        key "kubernetes-storage-key";
        192.168.1.84;
    };
    update-policy { grant kubernetes-storage-key zonesub ANY; };
};
