setLocal("0.0.0.0:53", {})
setSecurityPollSuffix("")

newServer({
    pool                          = "bind",
    address                       = "192.168.1.42:5300",
    checkInterval                 = 1,
    maxCheckFailures              = 3,
    useClientSubnet               = true
})

newServer({
    pool                          = "blocky",
    address                       = "192.168.1.42:5301",
    checkInterval                 = 1,
    maxCheckFailures              = 3,
    useClientSubnet               = true
})
setECSSourcePrefixV4(32) -- Forward requester IP to Blocky

newServer({
    pool                 = "cloudflare",
    address              = "1.1.1.1:853",
    tls                  = "openssl",
    subjectName          = "cloudflare-dns.com",
    validateCertificates = true,
    checkInterval        = 10,
    checkTimeout         = 2000
})

newServer({
    pool                 = "cloudflare",
    address              = "1.0.0.1:853",
    tls                  = "openssl",
    subjectName          = "cloudflare-dns.com",
    validateCertificates = true,
    checkInterval        = 10,
    checkTimeout         = 2000
})

pc = newPacketCache(10000, {
    maxTTL              = 86400,
    minTTL              = 0,
    temporaryFailureTTL = 60,
    staleTTL            = 60,
    dontAge             = false
})
getPool(""):setCache(pc)

addAction("192.168.50.0/24", PoolAction("cloudflare")) -- Guest
addAction("192.168.50.0/24", DropAction())             -- Guest
addAction("192.168.70.0/24", PoolAction("cloudflare")) -- IOT
addAction("192.168.70.0/24", DropAction())             -- IOT

addAction('devbu.io', PoolAction('bind'))
addAction('turbo.ac', PoolAction('bind'))
addAction('168.192.in-addr.arpa', PoolAction('bind'))

addAction("192.168.1.0/24", PoolAction("cloudflare")) -- LAN
addAction("192.168.10.0/24", PoolAction("blocky"))    -- Trusted
addAction("192.168.42.0/24", PoolAction("blocky"))    -- Server
addAction("192.168.80.0/24", PoolAction("blocky"))    -- Wireguard
